<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b1020" />
  <style>
    :root{
      --bg:#0b1020;
      --text:#eef1ff;
      --muted:#b7c0ff;
      --accent:#ffd36a;
      --stroke:rgba(255,255,255,.16);
      --radius:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      color:var(--text);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 700px at 18% 8%, #1b2a63 0%, transparent 58%),
        radial-gradient(900px 600px at 85% 20%, #103a4a 0%, transparent 60%),
        radial-gradient(900px 600px at 35% 88%, #3a2454 0%, transparent 60%),
        linear-gradient(180deg, #070a14 0%, var(--bg) 35%, #070a14 100%);
      overflow-x:hidden;
    }
    .wrap{width:min(980px, 92vw); margin:0 auto; padding:22px 0 70px}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:10px 6px; flex-wrap:wrap;
    }
    .chip{
      display:inline-flex; align-items:center; gap:10px;
      padding:9px 12px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background: rgba(255,255,255,.06);
      color:var(--muted);
      font-size:14px;
      backdrop-filter: blur(10px);
    }
    .chip b{color:var(--text)}
    .actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center}

    /* ======== Control de audio ======== */
    .audioCtl{
      display:flex; align-items:center; gap:10px;
      padding:8px 10px;
      border:1px solid var(--stroke);
      border-radius:12px;
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
    }
    .volBtn{
      width:40px; height:38px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.14);
      border-radius:10px;
      background: rgba(0,0,0,.18);
      color:var(--text);
      cursor:pointer;
      user-select:none;
      touch-action: manipulation;
      transition: transform .08s ease, background .18s ease;
    }
    .volBtn:hover{background: rgba(255,255,255,.10)}
    .volBtn:active{transform: translateY(1px)}
    .volRange{width:130px; accent-color: var(--accent)}
    .volHint{font-size:12px; color:var(--muted); margin-left:4px}

    .panel{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      overflow:hidden;
    }

    /* HERO */
    .hero{margin-top:14px}
    .heroGrid{display:grid; grid-template-columns: 1fr 420px; gap:0}
    @media (max-width: 940px){ .heroGrid{grid-template-columns:1fr} }
    .left{padding:24px 22px 18px 22px}
    .title{
      margin:0;
      font-size: clamp(28px, 3.6vw, 44px);
      line-height:1.06;
      letter-spacing:.2px;
    }
    .spark{color: var(--accent); text-shadow: 0 0 22px rgba(255,211,106,.25)}
    .subtitle{margin:12px 0 0 0; color:var(--muted); font-size:15px; line-height:1.65; max-width:62ch}
    .right{
      border-left: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.08));
      padding:18px 18px 22px 18px;
      display:grid; place-items:center;
    }
    @media (max-width: 940px){
      .right{border-left:0; border-top:1px solid rgba(255,255,255,.10)}
    }

    /* ===========================
       SOBRE
       =========================== */
    .envelope{
      --fit: cover;
      --pos: 50% 35%;
      --zoom: 1.02;
      --showBlur: 0;

      width: min(360px, 88vw);
      aspect-ratio: 4 / 3;
      position:relative;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transform: translateZ(0);
      border-radius: 20px;
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
    }
    .envFrame{
      position:absolute; inset:0;
      border-radius: 20px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.03);
    }
    .envPhoto{position:absolute; inset:0}
    .envPhoto img{width:100%; height:100%; display:block}
    .envPhoto .bg{
      position:absolute; inset:-30px;
      width: calc(100% + 60px);
      height: calc(100% + 60px);
      object-fit: cover;
      object-position: var(--pos);
      filter: blur(18px) saturate(1.15) contrast(1.05);
      transform: scale(1.18);
      opacity: calc(.85 * var(--showBlur));
      pointer-events:none;
    }
    .envPhoto .main{
      position:absolute; inset:0;
      object-fit: var(--fit);
      object-position: var(--pos);
      transform: scale(var(--zoom));
      filter: saturate(1.06) contrast(1.04);
      background: rgba(0,0,0,.15);
    }
    .envShade{
      position:absolute; inset:0;
      background:
        radial-gradient(900px 360px at 30% 0%, rgba(255,255,255,.14), transparent 58%),
        radial-gradient(700px 420px at 50% 70%, rgba(0,0,0,.12), rgba(0,0,0,.42)),
        linear-gradient(180deg, rgba(0,0,0,.06), rgba(0,0,0,.32));
      pointer-events:none;
    }
    .envLines{
      position:absolute; inset:0;
      opacity:.30;
      pointer-events:none;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.20));
    }

    /* Carta que sube al abrir */
    .envLetter{
      position:absolute;
      left:10%; right:10%;
      top:18%;
      height:70%;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 16px 32px rgba(0,0,0,.35);
      transform: translateY(34px);
      opacity:.95;
      transition: transform .75s cubic-bezier(.2,.85,.2,1), opacity .35s ease;
      display:flex; flex-direction:column; gap:10px;
      padding:14px;
      pointer-events:none;
    }
    .miniLine{height:10px; border-radius: 8px; background: rgba(255,255,255,.10)}
    .miniLine.w1{width:78%}
    .miniLine.w2{width:92%}
    .miniLine.w3{width:60%}

    /* Solapa */
    .envFlap{
      position:absolute;
      inset:0;
      pointer-events:none;
      transform-origin: 50% 22%;
      transform: rotateX(0deg);
      transition: transform .75s cubic-bezier(.2,.85,.2,1);
      backface-visibility:hidden;
    }
    .envFlap svg{width:100%; height:100%}

    /* Sello */
    .seal{
      position:absolute;
      left:50%;
      top:58%;
      transform: translate(-50%, -50%);
      width:64px;
      height:64px;
      display:grid;
      place-items:center;
      font-weight:900;
      color: rgba(255,255,255,.95);
      text-shadow: 0 2px 16px rgba(90,160,255,.55);
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.35), rgba(255,255,255,0) 55%),
        linear-gradient(180deg, rgba(70,150,255,.55), rgba(40,110,235,.38));
      border: 1px solid rgba(150,210,255,.55);
      box-shadow:
        0 16px 28px rgba(0,0,0,.38),
        0 0 26px rgba(80,160,255,.28),
        inset 0 1px 0 rgba(255,255,255,.30),
        inset 0 -10px 18px rgba(0,0,0,.22);
      clip-path: path("M 32 56 C 32 56 7 40 7 23 C 7 14 14 8 22 8 C 27 8 31 11 32 14 C 33 11 37 8 42 8 C 50 8 57 14 57 23 C 57 40 32 56 32 56 Z");
      pointer-events:none;
    }
    .seal::after{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(circle at 30% 22%, rgba(255,255,255,.40), transparent 60%);
      clip-path: inherit;
      pointer-events:none;
    }

    /* Estado abierto */
    .opened .envFlap{transform: rotateX(180deg)}
    .opened .envLetter{transform: translateY(-10px); opacity:1}

    /* CARTA */
    main{margin-top:16px; display:none}
    .paperWrap{padding:18px}
    .paper{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .paperHead{
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .paperHead .small{color:var(--muted); font-size:13px}
    .paperBody{padding:16px}
    .letterTitle{margin:0 0 10px 0; font-size:18px; letter-spacing:.2px}
    .typeArea{
      font-size:15px; line-height:1.7;
      white-space: pre-wrap; word-break: break-word;
      min-height: 160px;
    }
    .cursor{
      display:inline-block; width:10px;
      transform: translateY(2px);
      animation: blink 1s steps(1) infinite;
      color: var(--accent);
      font-weight:900;
    }
    @keyframes blink{50%{opacity:0}}

    .photoBox{margin-top:14px; display:none; grid-template-columns: 1fr 1fr; gap:12px; align-items:start}
    @media (max-width: 820px){ .photoBox{grid-template-columns:1fr} }
    .photo{
      width:100%;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      overflow:hidden;
    }
    .photo img{width:100%; height:auto; display:block}
    .blocks{display:grid; gap:10px}
    .block{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      background: rgba(0,0,0,.14);
      padding:14px;
    }
    .block h3{margin:0; font-size:15px}
    .block p{margin:6px 0 0 0; color:var(--muted); font-size:14px; line-height:1.55}

    /* ===== Confeti CANVAS (siempre visible) ===== */
    #confettiCanvas{
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }

    @media (prefers-reduced-motion: reduce){
      .envFlap, .envLetter{transition:none}
      .cursor{animation:none}
      /* si prefieres que salga aun con reduce motion, borra la l√≠nea de abajo */
      /* #confettiCanvas{display:none} */
    }
  </style>
</head>

<body>
  <!-- Confeti en canvas -->
  <canvas id="confettiCanvas" aria-hidden="true"></canvas>

  <!-- Audio -->
  <audio id="bgm" src="musica.mp3" preload="auto" loop></audio>

  <div class="wrap">
    <header>
      <div class="subtitle">‚ú® <span>De <b id="toNameChip">Irene</b> ‚Äî <b>2026</b></span></div>

      <div class="actions">
        <div class="audioCtl" aria-label="Control de m√∫sica">
          <button class="volBtn" id="volBtn" type="button" aria-label="Silenciar o activar m√∫sica" title="Silenciar / Activar">
            <span id="volIcon" aria-hidden="true">üîä</span>
          </button>
          <input class="volRange" id="volRange" type="range" min="0" max="100" value="60" aria-label="Volumen" />
          <span class="volHint" id="volTxt">60%</span>
        </div>
      </div>
    </header>

    <section class="hero panel" id="hero">
      <div class="heroGrid">
        <div class="left">
          <h1 class="title"><span id="toNameTitle">Irene</span>, <span class="spark">feliz 2026</span> üíù</h1>
          <p class="subtitle">
            
Una personita especial, se merece una felicitaci√≥n de a√±o especial. Quer√≠a dejarte algo bonito para empezar el a√±o: una cartita escrita por m√≠, solo para ti. Si quieres leerla, tan solo tienes que pulsar en el sobre decorado con nuestra fotito. Al abrirlo, podr√°s escuchar una melod√≠a que te resultar√° familiar. Espero que te guste y te haga comenzar el 2026 con una sonrisa.
          </p>
        </div>

        <div class="right">
          <div>
            <div class="envelope" id="envelope" role="button" aria-label="Abrir carta" tabindex="0">
              <div class="envFrame">
                <div class="envPhoto">
                  <img id="envImgBg" class="bg" alt="" aria-hidden="true" />
                  <img id="envImgMain" class="main" alt="Imagen del sobre" />
                </div>

                <div class="envShade"></div>

                <div class="envLetter" aria-hidden="true">
                  <div class="miniLine w2"></div>
                  <div class="miniLine w1"></div>
                  <div class="miniLine w3"></div>
                  <div class="miniLine w2"></div>
                </div>

                <svg class="envLines" viewBox="0 0 400 300" preserveAspectRatio="none" aria-hidden="true">
                  <rect x="10" y="10" width="380" height="280" rx="18" ry="18"
                        fill="rgba(255,255,255,0.02)" stroke="rgba(255,255,255,0.20)" stroke-width="2"/>
                  <path d="M20 80 L200 185 L380 80" fill="none" stroke="rgba(255,255,255,0.24)" stroke-width="3" />
                  <path d="M20 285 L200 175 L380 285" fill="none" stroke="rgba(255,255,255,0.14)" stroke-width="2" />
                </svg>

                <div class="envFlap" aria-hidden="true">
                  <svg viewBox="0 0 400 300" preserveAspectRatio="none">
                    <path d="M20 80 L200 200 L380 80"
                          fill="rgba(0,0,0,0.18)" stroke="rgba(255,255,255,0.16)" stroke-width="2"/>
                    <path d="M20 80 L200 200 L380 80"
                          fill="none" stroke="rgba(255,255,255,0.18)" stroke-width="3"/>
                  </svg>
                </div>

                <div class="seal" id="seal">I</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <main id="content" class="panel">
      <div class="paperWrap">
        <div class="paper">
          <div class="paperHead">
            <div class="small" id="paperMeta">1 de enero de 2026</div>
            <div></div>
          </div>

          <div class="paperBody">
            <h2 class="letterTitle" id="letterHeading">Para la ni√±a m√°s bonita</h2>
            <div class="typeArea" id="typeArea"></div>

            <div class="photoBox" id="photoBox">
              <div class="photo"><img id="photoImg" alt="Foto" /></div>
              <div class="blocks" id="blocks"></div>
            </div>

          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const CONFIG = {
      toName: "Irene",
      fromName: "‚Äî Yo",
      dateText: "1 de enero de 2026",

      envelopeImageUrl: "sobre.jpg",
      envelopeFitMode: "cover", // "cover" | "contain-blur"
      envelopePosition: "50% 35%",
      envelopeZoom: 1.03,

      photoUrl: "",

      letterParagraphs: [
        "Irene,\n",
        "Quer√≠a empezar 2026 dej√°ndote esto por escrito, porque hay cosas que en el d√≠a a d√≠a se dicen poco: estoy orgulloso de ti.\n",
        "Este a√±o no ha sido f√°cil, y aun as√≠ has seguido. A veces con fuerza, a veces con cansancio, a veces simplemente tirando‚Ä¶ pero has seguido. Y eso vale much√≠simo.\n",
        "Has conseguido cosas que quiz√° desde fuera parecen peque√±as, pero en realidad son enormes: levantarte cuando te costaba, volver a intentar, cuidarte un poco m√°s, poner l√≠mites cuando tocaba, y seguir siendo t√∫ incluso en d√≠as grises.\n",
        "Ojal√° 2026 te trate con m√°s calma, m√°s luz y m√°s ratitos buenos. Y si en alg√∫n momento te apetece compartir alguno de esos ratitos conmigo‚Ä¶ yo encantado.\n",
        "\nFeliz 2026, Irene ‚ú®\n"
      ],

      highlightBlocks: [
        { title: "Lo que has hecho bien", text: "Seguir incluso cuando no apetec√≠a." },
        { title: "Lo que has aprendido", text: "Que cuidarte tambi√©n es avanzar." },
        { title: "Lo que te mereces", text: "Un a√±o m√°s suave y con m√°s sonrisas." }
      ],

      // Audio
      initialVolume: 0.60
    };

    const hero = document.getElementById("hero");
    const envelope = document.getElementById("envelope");
    const content = document.getElementById("content");
    const typeArea = document.getElementById("typeArea");
    const toNameTitle = document.getElementById("toNameTitle");
    const toNameChip = document.getElementById("toNameChip");
    const seal = document.getElementById("seal");
    const paperMeta = document.getElementById("paperMeta");
    const letterHeading = document.getElementById("letterHeading");

    const envImgBg = document.getElementById("envImgBg");
    const envImgMain = document.getElementById("envImgMain");

    const photoBox = document.getElementById("photoBox");
    const photoImg = document.getElementById("photoImg");
    const blocks = document.getElementById("blocks");

    // Audio UI
    const bgm = document.getElementById("bgm");
    const volBtn = document.getElementById("volBtn");
    const volIcon = document.getElementById("volIcon");
    const volRange = document.getElementById("volRange");
    const volTxt = document.getElementById("volTxt");

    // ===== Confeti CANVAS (siempre visible) =====
    const confettiCanvas = document.getElementById("confettiCanvas");
    const confettiCtx = confettiCanvas.getContext("2d", { alpha: true });

    let confettiRunning = false;
    let confettiParticles = [];
    let confettiRAF = 0;

    function resizeConfettiCanvas(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      confettiCanvas.width  = Math.floor(window.innerWidth * dpr);
      confettiCanvas.height = Math.floor(window.innerHeight * dpr);
      confettiCanvas.style.width = window.innerWidth + "px";
      confettiCanvas.style.height = window.innerHeight + "px";
      confettiCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    resizeConfettiCanvas();
    window.addEventListener("resize", resizeConfettiCanvas, { passive:true });

    function launchConfettiOnceFromElement(el){
      if (confettiRunning) return; // una sola vez
      confettiRunning = true;

      const r = el.getBoundingClientRect();
      const originX = r.left + r.width * 0.5;
      const originY = r.top  + r.height * 0.45;

      const colors = [
        "#ff4d6d","#ffd166","#06d6a0","#4dabf7","#b197fc","#ff9f1c",
        "#f72585","#72efdd","#f9c74f","#90be6d"
      ];

      const count = 180; // para que se note s√≠ o s√≠
      confettiParticles = [];

      for (let i = 0; i < count; i++){
        const ang = Math.random() * Math.PI * 2;
        const sp  = 4 + Math.random() * 9;

        confettiParticles.push({
          x: originX,
          y: originY,
          vx: Math.cos(ang) * sp,
          vy: Math.sin(ang) * sp - (6 + Math.random() * 6), // empuj√≥n hacia arriba
          g: 0.22 + Math.random() * 0.12,
          w: 5 + Math.random() * 7,
          h: 7 + Math.random() * 10,
          rot: Math.random() * Math.PI,
          vrot: (Math.random() * 0.28 - 0.14),
          color: colors[(Math.random() * colors.length) | 0],
          life: 0,
          ttl: 1200 + Math.random() * 900
        });
      }

      const start = performance.now();

      function frame(now){
        const dt = now - start;
        confettiCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);

        let alive = 0;

        // avance aproximado por frame (simple y estable)
        for (const p of confettiParticles){
          p.life += 16.7;
          if (p.life > p.ttl) continue;

          alive++;
          p.vy += p.g;
          p.x += p.vx;
          p.y += p.vy;
          p.rot += p.vrot;

          // desvanecer al final
          const t = p.life / p.ttl;
          const alpha = (t < 0.75) ? 1 : (1 - (t - 0.75) / 0.25);

          confettiCtx.save();
          confettiCtx.globalAlpha = Math.max(0, Math.min(1, alpha));
          confettiCtx.translate(p.x, p.y);
          confettiCtx.rotate(p.rot);
          confettiCtx.fillStyle = p.color;
          confettiCtx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
          confettiCtx.restore();
        }

        if (alive > 0 && dt < 2600){
          confettiRAF = requestAnimationFrame(frame);
        } else {
          confettiCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);
          cancelAnimationFrame(confettiRAF);
          confettiRunning = false;
        }
      }

      confettiRAF = requestAnimationFrame(frame);
    }

    // Pintar datos
    toNameTitle.textContent = CONFIG.toName;
    toNameChip.textContent = CONFIG.toName;
    seal.textContent = (CONFIG.toName || "I").trim().charAt(0).toUpperCase();
    paperMeta.textContent = CONFIG.dateText;
    letterHeading.textContent = `Para ${CONFIG.toName}`;

    // Config visual del sobre
    envelope.style.setProperty("--pos", CONFIG.envelopePosition);
    envelope.style.setProperty("--zoom", String(CONFIG.envelopeZoom));

    if (CONFIG.envelopeFitMode === "contain-blur") {
      envelope.style.setProperty("--fit", "contain");
      envelope.style.setProperty("--showBlur", "1");
    } else {
      envelope.style.setProperty("--fit", "cover");
      envelope.style.setProperty("--showBlur", "0");
    }

    // Imagen del sobre
    envImgBg.src = CONFIG.envelopeImageUrl;
    envImgMain.src = CONFIG.envelopeImageUrl;

    // Foto dentro de la carta + bloques
    if (CONFIG.photoUrl && CONFIG.photoUrl.trim() !== "") {
      photoImg.src = CONFIG.photoUrl.trim();
      photoBox.style.display = "grid";
      blocks.innerHTML = "";
      for (const b of CONFIG.highlightBlocks) {
        const d = document.createElement("div");
        d.className = "block";
        d.innerHTML = `<h3>${escapeHtml(b.title)}</h3><p>${escapeHtml(b.text)}</p>`;
        blocks.appendChild(d);
      }
    } else {
      photoBox.style.display = "none";
    }

    // ===== Audio =====
    function setVolume(v01){
      const clamped = Math.max(0, Math.min(1, v01));
      bgm.volume = clamped;
      const pct = Math.round(clamped * 100);
      volRange.value = String(pct);
      volTxt.textContent = `${pct}%`;

      if (bgm.muted || clamped === 0) volIcon.textContent = "üîá";
      else if (clamped < 0.5) volIcon.textContent = "üîâ";
      else volIcon.textContent = "üîä";
    }
    setVolume(CONFIG.initialVolume);

    async function tryPlayAudio(){ try{ await bgm.play(); }catch{} }
    tryPlayAudio();

    const unlockAudioOnce = async () => {
      try { await bgm.play(); } catch {}
      window.removeEventListener("pointerdown", unlockAudioOnce);
      window.removeEventListener("keydown", unlockAudioOnce);
    };
    window.addEventListener("pointerdown", unlockAudioOnce, { once:false });
    window.addEventListener("keydown", unlockAudioOnce, { once:false });

    volBtn.addEventListener("click", async () => {
      bgm.muted = !bgm.muted;
      if (!bgm.muted) { try { await bgm.play(); } catch {} }
      setVolume(bgm.volume);
    });

    volRange.addEventListener("input", async (e) => {
      const pct = Number(e.target.value || 0);
      const v = pct / 100;
      bgm.muted = (v === 0);
      setVolume(v);
      if (!bgm.muted) { try { await bgm.play(); } catch {} }
    });

    // ===== Abrir + typewriter =====
    let opened = false;
    let typing = false;
    let cancelTyping = false;

    function openLetter(){
      if (opened) return;
      opened = true;

      hero.classList.add("opened");
      envelope.classList.add("opened");

      // Confeti autom√°tico (UNA vez) y visible
      launchConfettiOnceFromElement(envelope);

      content.style.display = "block";
      setTimeout(() => content.scrollIntoView({behavior:"smooth", block:"start"}), 220);

      startTyping();
    }

    function startTyping(){
      if (typing) return;
      typing = true;
      cancelTyping = false;

      typeArea.textContent = "";
      const cursor = document.createElement("span");
      cursor.className = "cursor";
      cursor.textContent = "‚ñç";
      typeArea.appendChild(cursor);

      const fullText = CONFIG.letterParagraphs.join("");
      let i = 0;

      const tick = () => {
        if (cancelTyping){
          typeArea.textContent = fullText + "\n" + CONFIG.fromName;
          typing = false;
          return;
        }
        if (i >= fullText.length){
          typeArea.textContent = fullText + "\n" + CONFIG.fromName;
          typing = false;
          return;
        }
        cursor.insertAdjacentText("beforebegin", fullText.charAt(i));
        i++;

        const ch = fullText.charAt(i-1);
        const base = (ch === "\n") ? 120 : 22;
        const jitter = Math.random() * 22;
        setTimeout(tick, base + jitter);
      };

      tick();
    }

    // Eventos: SOLO SOBRE
    envelope.addEventListener("click", openLetter);
    envelope.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") openLetter();
    });

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
  });
  </script>
</body>
</html>
